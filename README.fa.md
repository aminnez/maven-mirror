# میرورینگ ریپازیتوری Maven

**[English](./README.md)**

این پروژه یک سرور میرور برای Maven فراهم می‌کند که با استفاده از **Fastify** ساخته شده است و به شما امکان می‌دهد تا درخواست‌ها را به چندین ریپازیتوری Maven بالادستی **پراکسی** کنید. این پروژه دارای یک مکانیزم بازگشتی قوی است تا اطمینان حاصل کند که سورس‌ها از اولین سورس موجود بازیابی می‌شوند و قابلیت اطمینان و دسترسی به وابستگی‌های Maven را افزایش می‌دهد.

همچنین، این ابزار به خصوص برای توسعه‌دهندگانی که در مناطقی تحت تأثیر تحریم‌ها مانند **ایران** هستند، مفید است، زیرا دسترسی محدودی به ریپازیتوری اصلی Maven دارند. با عمل به عنوان یک پراکسی، این سرور میرور می‌تواند به عبور از چنین محدودیت‌ها کمک کند و دسترسی بدون مشکل به وابستگی‌های ضروری را فراهم کند.

این سرور همچنین از **کشینگ** پشتیبانی می‌کند تا عملکرد را با کاهش تأخیر و صرفه‌جویی در پهنای باند بهبود بخشد. مدت زمان کش قابل تنظیم است که آن را برای استفاده محلی به منظور سرعت بخشیدن به بیلدها یا به عنوان کش سمت سرور برای کاهش درخواست‌های شبکه مناسب می‌سازد.

## فهرست مطالب

- [میرورینگ ریپازیتوری Maven](#میرورینگ-ریپازیتوری-maven)
  - [فهرست مطالب](#فهرست-مطالب)
    - [پیکربندی](#پیکربندی)
  - [استفاده](#استفاده)
    - [مورد استفاده: عبور از تحریم‌ها](#مورد-استفاده-عبور-از-تحریمها)
    - [ویژگی‌های کشینگ](#ویژگیهای-کشینگ)
    - [راه‌اندازی سرور:](#راهاندازی-سرور)
  - [اجرا با Docker](#اجرا-با-docker)
    - [استفاده از docker compose](#استفاده-از-docker-compose)
    - [دستی](#دستی)
    - [توضیح مثال Docker](#توضیح-مثال-docker)
    - [مدیریت Volumeها](#مدیریت-volumeها)
  - [مشارکت](#مشارکت)
  - [مجوز](#مجوز)

### پیکربندی

در صورت نیاز، فایل `config.yml` را ویرایش کنید تا تنظیمات سفارشی را اعمال کنید:
  - بخش `REPOSITORIES` را به‌روزرسانی کنید تا ریپازیتوری‌های Maven مورد نظر برای میرور را مشخص کنید.
  - تنظیمات دیگر مانند شماره پورت، گزینه‌های کشینگ، یا سرورهای پراکسی را مطابق نیاز خود تنظیم کنید.
  - مدت زمان کش را با `CACHE_TIME` (بر حسب ثانیه) پیکربندی کنید.

نمونه پیکربندی:

```yaml
PROXIES:
  nordvpn:
    host: nordvpn.com
    port: 2080
    protocol: http # پروتکل‌های پشتیبانی شده: http, https, و socks

  private:
    host: myserver.com
    port: 2081
    protocol: socks
    auth:                  # اختیاری: اطلاعات احراز هویت
      username: myusername #
      password: mypassword #

  local:
    host: 127.0.0.1
    port: 1080
    protocol: socks

REPOSITORIES:
  - name: central
    url: https://repo1.maven.org/maven2
    proxy: nordvpn # اختیاری: انتخاب یک سرور پراکسی

  - name: private-repo
    url: https://repo.mycompany.com/maven
    auth:                  # اختیاری: اطلاعات احراز هویت
      username: myusername #
      password: mypassword #

CACHE_TIME: 2592000 # زمان پیش‌فرض کش: 30 روز (بر حسب ثانیه)
```

## استفاده

### مورد استفاده: عبور از تحریم‌ها
یکی از کاربردهای مهم این میرور Maven فراهم کردن دسترسی به مناطق تحت تحریم مانند ایران است. به دلیل تحریم‌های بین‌المللی، توسعه‌دهندگان در برخی مناطق ممکن است با مشکلاتی برای دسترسی به ریپازیتوری‌های محبوب Maven مواجه شوند. این سرور میرور می‌تواند به عنوان یک پراکسی برای عبور از چنین محدودیت‌ها عمل کند:

- انتقال درخواست‌ها به ریپازیتوری‌ Maven بالادستی از طریق یک نقطه دسترسی مرکزی.
- استفاده از سرورهای پراکسی برای اتصال به ریپازیتوری‌های مسدود شده.
- کنترل کامل بر اینکه کدام ریپازیتوری بالادستی دسترسی داده می‌شوند.

### ویژگی‌های کشینگ
این پروژه از کش فایل برای افزایش عملکرد پشتیبانی می‌کند:
- **استفاده محلی از سرور**: کش فایل‌ها به صورت محلی برای سرعت بخشیدن به بیلدهای تکراری و کاهش تأخیر.
- **استفاده در سرور**: کاهش مصرف پهنای باند با کش کردن وابستگی‌های پرتکرار.

مدت زمان کش را با `CACHE_TIME` (پیش‌فرض ۳۰ روز) در `config.yml` پیکربندی کنید.

### راه‌اندازی سرور:

1. میرور Maven را راه‌اندازی کنید:

```bash
yarn start
```

2. فایل‌های `build.gradle` در Gradle خود را به روز کنید تا به نقطه دسترسی میرور محلی برای وابستگی‌های Maven اشاره کند:

```groovy
buildscript {
    repositories {
        mavenLocal();
        maven { url "https://example.com:9443" } // از پورت پیکربندی شده خود استفاده کنید
        ...
    }
}
allprojects {
    buildscript {
        repositories {
            mavenLocal()
            maven { url "https://example.com:9443" }
            ...
        }
    }
    repositories {
        mavenLocal()
        maven { url "https://example.com:9443" }
        ...
    }
}
```

3. بیلدهای Gradle خود را به صورت معمول ادامه دهید. وابستگی‌ها از طریق میرور حل خواهند شد.

## اجرا با Docker

شما همچنین می‌توانید میرورینگ ریپازیتوری Maven را با استفاده از Docker اجرا کنید. این کار می‌تواند استقرار را ساده کرده و از یکپارچگی محیط‌ها اطمینان حاصل کند.

### استفاده از docker compose

1. یک `docker-compose.yml` بسازید:

```yml
services:
  mirror:
    image: ghcr.io/aminnez/maven-mirror:latest
    restart: unless-stopped
    ports:
      - 9443:9443
    volumes:
      - ./config.yml:/home/app/config.yml
      - ./privkey.pem:/home/app/privkey.pem
      - ./cert.pem:/home/app/cert.pem
      - ./local-cache:/home/app/local-cache
```

2. اجرا کنید

```bash
docker compose up -d
```

### دستی
برای استفاده از تصویر Docker `aminnez/maven-mirror:latest`، مراحل زیر را دنبال کنید:

1. تصویر Docker را دریافت کنید:

```bash
docker pull ghcr.io/aminnez/maven-mirror:latest
```

2. کانتینر Docker را اجرا کنید، پورت ۹۴۴۳ را نگاشت کنید و فایل پیکربندی و دایرکتوری کش را پیوست کنید:

```bash
docker run -d \
-p 9443:9443 \
-v /your/config.yml:/home/app/config.yml \
-v /your/privkey.pem:/home/app/pivkey.pem \
-v /your/cert.pem:/home/app/cert.pem \
-v /your/local-cache:/home/app/local-cache \
aminnez/maven-mirror:latest
```

### توضیح مثال Docker

- `-d`: اجرای کانتینر در پس‌زمینه.
- `-p 9443:9443`: نگاشت پورت ۹۴۴۳ در هاست به پورت ۹۴۴۳ در داخل کانتینر.
- `-v /your/config.yml:/home/app/config.yml`: اتصال فایل پیکربندی از هاست به کانتینر، جهت پیکربندی‌های سفارشی.
- `-v /your/privkey.pem:/home/app/privkey.pem`: اتصال کلید خصوصی SSL از هاست به کانتینر برای پیکربندی HTTPS.
- `-v /your/cert.pem:/home/app/cert.pem`: اتصال گواهی SSL از هاست به کانتینر برای پیکربندی HTTPS.
- `-v /your/local-cache:/home/app/local-cache`: اتصال یک دایرکتوری محلی برای ذخیره فایل‌های کش شده، جهت کش ماندگار بین راه‌اندازی‌های مجدد کانتینر.

### مدیریت Volumeها
برای مدیریت مؤثر دایرکتوری کش، یک ولوم را به مکان `/home/app/local-cache` متصل کنید. این کار اجازه می‌دهد تا داده‌ها بین راه‌اندازی‌های مجدد کانتینر ماندگار بمانند و فایل‌های کش شده حفظ شوند.

نمونه‌ای از اتصال ولوم برای Docker:

```bash
-v /path/to/your-cache-directory:/home/app/local-cache
```

## مشارکت

از مشارکت شما استقبال می‌شود! لطفاً این دستورالعمل‌ها را دنبال کنید:

1. **Fork** کردن ریپازیتوری.
2.

 **ایجاد یک شاخه** برای ویژگی خود (`git checkout -b feature/YourFeature`).
3. **Commit** تغییرات خود (`git commit -am 'Add YourFeature'`).
4. **Push** کردن شاخه (`git push origin feature/YourFeature`).
5. **ایجاد یک درخواست Pull**.

## مجوز

این پروژه تحت [مجوز MIT](LICENSE) منتشر شده است که به شما امکان استفاده، تغییر و توزیع کد را به صورت آزاد می‌دهد. قبل از استفاده از پروژه، مطمئن شوید که شرایط مجوز را مطالعه و درک کرده‌اید.